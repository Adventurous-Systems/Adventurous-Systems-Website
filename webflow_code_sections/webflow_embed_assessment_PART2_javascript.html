<!-- 
================================================================================
AI READINESS ASSESSMENT FORM - PART 2 of 2: JAVASCRIPT
================================================================================
This file contains all JavaScript functionality for the assessment form.
It must be embedded SECOND in Webflow as a custom code embed (BELOW Part 1).

IMPORTANT: This is Part 2 of 2. Part 1 (HTML & CSS) must be embedded FIRST.
Both parts are required for the form to function properly.

Character count: 14,858 characters (29.7% of 50k limit)
================================================================================
-->

<script>
/* ============================================================================
   CONFIGURATION & CONSTANTS
   ============================================================================ */

// Google Apps Script URL for form submission
const FORM_SUBMIT_URL = 'https://script.google.com/macros/s/AKfycbwyvNqSngQKRH76AGf70xj6jTNQvJkvUQbfmHZotG7TOz-k5KJ-BuyTlcXKcPYA_cmu/exec';

// Total number of form sections (reduced from 8 to 7 after removing Section 7)
const TOTAL_SECTIONS = 7;

// Local storage key for saving form progress
const LOCAL_STORAGE_KEY = 'aiReadinessFormData';

/* ============================================================================
   GLOBAL STATE VARIABLES
   ============================================================================ */

// Current active section number (1-based)
let currentSection = 1;

// Object to store all form data
let formData = {};
/* ============================================================================
   INITIALIZATION
   ============================================================================ */

/**
 * Initialize the assessment form when the page loads
 * Handles both immediate execution and DOM ready states
 */
(function initializeAssessmentForm() {
    // Check if DOM is already loaded
    if (document.readyState === 'loading') {
        // Wait for DOM to be ready
        document.addEventListener('DOMContentLoaded', init);
    } else {
        // DOM is already ready, initialize immediately
        init();
    }
    
    /**
     * Main initialization function
     * Sets up the form state and displays the first section
     */
    function init() {
        // Load any previously saved progress from localStorage
        loadFormProgress();
        
        // Show the current section (usually 1, but could be restored from localStorage)
        showFormSection(currentSection);
        
        // Update the progress indicator
        updateProgressIndicator(currentSection, TOTAL_SECTIONS);
        
        // Set up PM Tools "Other" checkbox event listener
        setupPmToolsOtherToggle();
        
        // Log successful initialization
        console.log('Assessment form initialized successfully');
    }
})();
/* ============================================================================
   FORM NAVIGATION FUNCTIONS
   ============================================================================ */

/**
 * Show a specific form section and hide all others
 * @param {number} sectionNum - The section number to display (1-based)
 */
function showFormSection(sectionNum) {
    // Hide all sections first
    document.querySelectorAll('.as-form-section').forEach(section => {
        section.classList.remove('active');
    });
    
    // Show the target section
    const targetSection = document.querySelector(`.as-form-section[data-section="${sectionNum}"]`);
    if (targetSection) {
        targetSection.classList.add('active');
    }
    
    // Update navigation button states
    updateNavigationButtons(sectionNum);
    
    // Update progress indicator
    updateProgressIndicator(sectionNum, TOTAL_SECTIONS);
    
    // Scroll to top of page for better UX
    window.scrollTo({ top: 0, behavior: 'smooth' });
    
    // Update global current section variable
    currentSection = sectionNum;
}

/**
 * Navigate to the next form section
 * Validates current section before proceeding
 */
function nextFormSection() {
    // Validate current section before proceeding
    if (!validateSection(currentSection)) {
        return; // Stop if validation fails
    }
    
    // Save current progress to localStorage
    saveFormProgress();
    
    // Submit current section data to Google Sheets (partial submission)
    submitSectionToSheets(currentSection, false);
    
    // Move to next section if not at the end
    if (currentSection < TOTAL_SECTIONS) {
        showFormSection(currentSection + 1);
    }
}

/**
 * Navigate to the previous form section
 * No validation required when going backwards
 */
function previousFormSection() {
    // Save current progress (no validation needed for going back)
    saveFormProgress();
    
    // Move to previous section if not at the beginning
    if (currentSection > 1) {
        showFormSection(currentSection - 1);
    }
}
/**
 * Update navigation button visibility and states based on current section
 * @param {number} sectionNum - The current section number
 */
function updateNavigationButtons(sectionNum) {
    const backBtn = document.getElementById('formBackBtn');
    const nextBtn = document.getElementById('formNextBtn');
    const submitBtn = document.getElementById('formSubmitBtn');
    
    // Hide back button on first section
    if (sectionNum === 1) {
        backBtn.style.display = 'none';
    } else {
        backBtn.style.display = 'block';
    }
    
    // Show submit button on last section, next button otherwise
    if (sectionNum === TOTAL_SECTIONS) {
        nextBtn.style.display = 'none';
        submitBtn.style.display = 'block';
        // Generate review content for final section
        generateReviewContent();
    } else {
        nextBtn.style.display = 'block';
        submitBtn.style.display = 'none';
    }
}
/**
 * Update progress bar and text display
 * @param {number} current - Current section number
 * @param {number} total - Total number of sections
 */
function updateProgressIndicator(current, total) {
    const progressFill = document.getElementById('formProgressFill');
    const progressText = document.getElementById('formProgressText');
    const percentage = (current / total) * 100;
    
    // Update progress bar width
    if (progressFill) {
        progressFill.style.width = percentage + '%';
    }
    
    // Update progress text with section name
    if (progressText) {
        const sectionNames = [
            'Company Information',
            'Technology Landscape',
            'Challenges & Pain Points',
            'AI & Automation Interest',
            'Decision Making & Timeline',
            'Assessment Goals',
            'Review & Submit'
        ];
        progressText.textContent = `Step ${current} of ${total}: ${sectionNames[current - 1] || ''}`;
    }
}
/**
 * Validate the current form section
 * @param {number} sectionNum - The section number to validate
 * @returns {boolean} - True if valid, false if validation errors found
 */
function validateSection(sectionNum) {
    const section = document.querySelector(`.as-form-section[data-section="${sectionNum}"]`);
    if (!section) return true;
    
    let isValid = true;
    
    // Clear previous error messages
    section.querySelectorAll('.as-form-error').forEach(error => {
        error.classList.remove('show');
    });
    
    // Validate required text inputs, selects, and textareas
    section.querySelectorAll('input[required], select[required], textarea[required]').forEach(field => {
        if (!field.value.trim()) {
            showValidationError(field);
            isValid = false;
        }
    });
    
    // Validate required radio groups
    section.querySelectorAll('input[type="radio"][required]').forEach(radio => {
        const name = radio.getAttribute('name');
        const checked = section.querySelector(`input[name="${name}"]:checked`);
        if (!checked) {
            showValidationError(radio);
            isValid = false;
        }
    });
    
    // Validate checkbox groups that require at least one selection
    const challengesGroup = section.querySelector('input[name="topChallenges"]');
    if (challengesGroup) {
        const checkedChallenges = section.querySelectorAll('input[name="topChallenges"]:checked');
        if (checkedChallenges.length === 0) {
            showValidationError(challengesGroup);
            isValid = false;
        }
    }
    
    const aiPrioritiesGroup = section.querySelector('input[name="aiPriorities"]');
    if (aiPrioritiesGroup) {
        const checkedPriorities = section.querySelectorAll('input[name="aiPriorities"]:checked');
        if (checkedPriorities.length === 0) {
            showValidationError(aiPrioritiesGroup);
            isValid = false;
        }
    }
    
    const assessmentGoalsGroup = section.querySelector('input[name="assessmentGoals"]');
    if (assessmentGoalsGroup) {
        const checkedGoals = section.querySelectorAll('input[name="assessmentGoals"]:checked');
        if (checkedGoals.length === 0) {
            showValidationError(assessmentGoalsGroup);
            isValid = false;
        }
    }
    
    return isValid;
}
/**
 * Show validation error for a specific field
 * @param {HTMLElement} field - The field that failed validation
 */
function showValidationError(field) {
    const fieldContainer = field.closest('.as-form-field');
    if (fieldContainer) {
        const errorElement = fieldContainer.querySelector('.as-form-error');
        if (errorElement) {
            errorElement.classList.add('show');
        }
    }
    
    // Add visual feedback to field
    field.style.borderColor = '#dc2626';
    setTimeout(() => {
        field.style.borderColor = '';
    }, 3000);
}
/**
 * Collect all form data into a single object
 * @returns {Object} - Object containing all form field values
 */
function collectFormData() {
    const form = document.getElementById('aiReadinessForm');
    const data = {};
    
    // Get all text inputs, textareas, and selects
    form.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], input[type="url"], textarea, select').forEach(field => {
        const name = field.getAttribute('name');
        if (name) {
            data[name] = field.value;
        }
    });
    
    // Get radio button values
    form.querySelectorAll('input[type="radio"]:checked').forEach(radio => {
        const name = radio.getAttribute('name');
        if (name) {
            data[name] = radio.value;
        }
    });
    
    // Get checkbox values (as arrays)
    const checkboxNames = ['designSoftware', 'pmTools', 'dataStorage', 'topChallenges', 'aiPriorities', 'assessmentGoals'];
    checkboxNames.forEach(name => {
        const checkboxes = form.querySelectorAll(`input[name="${name}"]:checked`);
        data[name] = Array.from(checkboxes).map(cb => cb.value);
    });
    
    // Handle PM Tools "Other" field - if "Other" is selected, include the custom text
    const pmOtherCheckbox = form.querySelector('input[name="pmTools"][value="Other"]');
    const pmOtherText = form.querySelector('input[name="pmToolsOther"]');
    if (pmOtherCheckbox && pmOtherCheckbox.checked && pmOtherText && pmOtherText.value.trim()) {
        // Replace "Other" with the actual text value
        const pmToolsArray = data.pmTools || [];
        const otherIndex = pmToolsArray.indexOf('Other');
        if (otherIndex !== -1) {
            pmToolsArray[otherIndex] = `Other: ${pmOtherText.value.trim()}`;
            data.pmTools = pmToolsArray;
        }
    }
    
    return data;
}
/**
 * Save form progress to localStorage
 * Stores current section, form data, and timestamp
 */
function saveFormProgress() {
    formData = collectFormData();
    const progressData = {
        currentSection: currentSection,
        completedSections: Array.from({ length: currentSection }, (_, i) => i + 1),
        formData: formData,
        lastSaved: new Date().toISOString()
    };
    
    try {
        localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(progressData));
        console.log('Progress saved to localStorage');
    } catch (error) {
        console.error('Error saving to localStorage:', error);
    }
}
/**
 * Load form progress from localStorage
 * @returns {boolean} - True if progress was loaded successfully
 */
function loadFormProgress() {
    try {
        const savedData = localStorage.getItem(LOCAL_STORAGE_KEY);
        if (savedData) {
            const progressData = JSON.parse(savedData);
            formData = progressData.formData || {};
            currentSection = progressData.currentSection || 1;
            restoreFormFields(formData);
            console.log('Progress loaded from localStorage');
            return true;
        }
    } catch (error) {
        console.error('Error loading from localStorage:', error);
    }
    return false;
}
/**
 * Restore form field values from saved data
 * @param {Object} data - The form data to restore
 */
function restoreFormFields(data) {
    const form = document.getElementById('aiReadinessForm');
    
    Object.keys(data).forEach(name => {
        const field = form.querySelector(`[name="${name}"]`);
        if (field && (field.tagName === 'INPUT' || field.tagName === 'TEXTAREA' || field.tagName === 'SELECT')) {
            if (field.type === 'radio') {
                const radio = form.querySelector(`input[name="${name}"][value="${data[name]}"]`);
                if (radio) radio.checked = true;
            } else if (field.type === 'checkbox') {
                if (Array.isArray(data[name])) {
                    data[name].forEach(value => {
                        // Handle PM Tools "Other" field specially
                        if (name === 'pmTools' && value.startsWith('Other: ')) {
                            const otherCheckbox = form.querySelector(`input[name="${name}"][value="Other"]`);
                            const otherTextInput = form.querySelector('input[name="pmToolsOther"]');
                            if (otherCheckbox && otherTextInput) {
                                otherCheckbox.checked = true;
                                otherTextInput.value = value.replace('Other: ', '');
                                // Show the text input field
                                const otherField = document.getElementById('pmOtherField');
                                if (otherField) {
                                    otherField.style.display = 'block';
                                }
                            }
                        } else {
                            const checkbox = form.querySelector(`input[name="${name}"][value="${value}"]`);
                            if (checkbox) checkbox.checked = true;
                        }
                    });
                }
            } else {
                field.value = data[name];
            }
        }
    });
}
/**
 * Clear form progress from localStorage
 */
function clearFormProgress() {
    try {
        localStorage.removeItem(LOCAL_STORAGE_KEY);
        console.log('Progress cleared from localStorage');
    } catch (error) {
        console.error('Error clearing localStorage:', error);
    }
}
/**
 * Submit section data to Google Sheets
 * @param {number} sectionNum - The section number being submitted
 * @param {boolean} isComplete - Whether this is a complete form submission
 */
function submitSectionToSheets(sectionNum, isComplete) {
    const data = collectFormData();
    const submission = {
        ...data,
        status: isComplete ? 'complete' : 'partial',
        currentSection: sectionNum,
        timestamp: new Date().toISOString()
    };
    
    fetch(FORM_SUBMIT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(submission)
    }).then(() => {
        console.log(`Section ${sectionNum} submitted (${isComplete ? 'complete' : 'partial'})`);
    }).catch(error => {
        console.error('Error submitting to Google Sheets:', error);
    });
}
/**
 * Submit the final form with complete validation
 */
function submitFinalForm() {
    // Validate current section before final submission
    if (!validateSection(currentSection)) {
        alert('Please review and complete all required fields.');
        return;
    }
    
    // Show loading state
    const submitBtn = document.getElementById('formSubmitBtn');
    const originalText = submitBtn.textContent;
    submitBtn.textContent = 'Submitting...';
    submitBtn.disabled = true;
    
    // Prepare final submission data
    const data = collectFormData();
    const submission = {
        ...data,
        status: 'complete',
        currentSection: TOTAL_SECTIONS,
        timestamp: new Date().toISOString()
    };
    
    // Submit to Google Sheets
    fetch(FORM_SUBMIT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(submission)
    }).then(() => {
        console.log('Form submitted successfully');
        clearFormProgress();
        showSuccessMessage();
    }).catch(error => {
        console.error('Error submitting form:', error);
        alert('There was an error submitting your form. Please try again or contact us directly.');
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
    });
}
/**
 * Show success message after form submission
 * Replaces the entire form container with success content
 */
function showSuccessMessage() {
    const container = document.querySelector('.as-form-container');
    container.innerHTML = `
        <div class="as-form-success">
            <div class="as-form-success-icon">✓</div>
            <h3>Thank You for Your Submission!</h3>
            <p>Your AI Readiness Assessment has been received. We'll review your information and contact you within 24 hours to schedule your discovery call.</p>
            <p><strong>What happens next:</strong></p>
            <ul style="text-align: left; display: inline-block; margin: 24px auto">
                <li style="margin-bottom: 12px">We'll send you a confirmation email</li>
                <li style="margin-bottom: 12px">Our team will review your assessment</li>
                <li style="margin-bottom: 12px">See you in the strategy session</li>
            </ul>
            <div>https://www.adventurous.systems/</div>
        </div>`;
    window.scrollTo({ top: 0, behavior: 'smooth' });
    // <li style="margin-bottom: 12px">We'll reach out to schedule your strategy session</li>
    // <li style="margin-bottom: 12px">You'll receive your comprehensive report</li>
}
/**
 * Generate review content for the final section
 * Creates a summary of all form data for user review
 */
function generateReviewContent() {
    const reviewContainer = document.getElementById('formReviewContent');
    if (!reviewContainer) return;
    
    const data = collectFormData();
    const sections = [
        {
            title: 'Company Information',
            fields: [
                { label: 'Company Name', key: 'companyName' },
                { label: 'Your Name', key: 'yourName' },
                { label: 'Role/Title', key: 'roleTitle' },
                { label: 'Email', key: 'email' },
                { label: 'Phone', key: 'phone' },
                { label: 'Company Website', key: 'companyWebsite' },
                { label: 'Primary Sector', key: 'primarySector' },
                { label: 'Company Size', key: 'companySize' },
                { label: 'Annual Revenue', key: 'annualRevenue' }
            ]
        },
        {
            title: 'Technology & Integration',
            fields: [
                { label: 'Design Software', key: 'designSoftware' },
                { label: 'PM Tools', key: 'pmTools' },
                { label: 'Data Storage', key: 'dataStorage' },
                { label: 'Integration Level', key: 'integrationLevel' }
            ]
        },
        {
            title: 'Challenges & Goals',
            fields: [
                { label: 'Top Challenges', key: 'topChallenges' },
                { label: 'Where You Lose Time/Money', key: 'timeMoneyLoss' },
                { label: 'AI Priorities', key: 'aiPriorities' },
                { label: 'Assessment Goals', key: 'assessmentGoals' }
            ]
        },
        {
            title: 'Timeline & Decision Making',
            fields: [
                { label: 'Budget Range', key: 'budgetRange' },
                { label: 'Implementation Timeline', key: 'implementationTimeline' },
                { label: 'Decision Making', key: 'decisionMaking' }
            ]
        }
    ];
    
    let html = '';
    sections.forEach(section => {
        html += `<div class="as-form-review-section">`;
        html += `<h4 class="as-form-review-title">${section.title}</h4>`;
        section.fields.forEach(field => {
            let value = data[field.key];
            
            // Format arrays
            if (Array.isArray(value)) {
                value = value.length > 0 ? value.join(', ') : 'Not specified';
            }
            
            // Handle empty values
            if (!value || value === '') {
                value = 'Not specified';
            }
            
            // Truncate long text
            if (typeof value === 'string' && value.length > 150) {
                value = value.substring(0, 150) + '...';
            }
            
            html += `
                <div class="as-form-review-item">
                    <div class="as-form-review-label">${field.label}:</div>
                    <div class="as-form-review-value">${value}</div>
                </div>
            `;
        });
        html += `</div>`;
    });
    
    reviewContainer.innerHTML = html;
}

/**
 * Set up the PM Tools "Other" checkbox toggle functionality
 */
function setupPmToolsOtherToggle() {
    const pmOtherCheckbox = document.getElementById('pm-other');
    const pmOtherField = document.getElementById('pmOtherField');
    
    if (pmOtherCheckbox && pmOtherField) {
        // Add event listener for checkbox change
        pmOtherCheckbox.addEventListener('change', function() {
            if (this.checked) {
                pmOtherField.style.display = 'block';
            } else {
                pmOtherField.style.display = 'none';
                // Clear the text input when unchecked
                const textInput = pmOtherField.querySelector('input[name="pmToolsOther"]');
                if (textInput) {
                    textInput.value = '';
                }
            }
        });
    }
}
</script>

<!-- ============================================================================
     CHARACTER COUNT & FILE INFO
     ============================================================================ -->
<!-- 
Current character count: 20,887 characters
Target limit: 50,000 characters per Webflow custom code embed
Status: ✅ UNDER LIMIT (41.8% of limit used)
Total for both parts: 62,772 characters
-->

<!-- 
================================================================================
END OF PART 2 - JAVASCRIPT
================================================================================
This completes the assessment form implementation.
Both Part 1 (HTML & CSS) and Part 2 (JavaScript) are required.
================================================================================
-->

